---
title: "Advanced Usage and Templates"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Advanced Usage and Templates}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(superzarathu)
```

# Advanced Usage

This vignette provides detailed information about each template and advanced usage patterns.

## Template Details

### 1. preprocess Template

The preprocess template provides a comprehensive data cleaning workflow:

```{r preprocess-details, eval=FALSE}
cat(get_templates()$preprocess)
```

**Key Features:**
- Tidyverse-based data manipulation
- Support for CSV and Excel files
- Data validation and cleaning steps
- EDA (Exploratory Data Analysis) guidance
- RDS output for downstream analysis

**Typical Use Case:**
```r
# Load raw data
raw_data <- read_csv("data/raw_survey.csv")

# Apply preprocess template steps
processed_df <- raw_data %>%
  rename(id = `환자번호`, age = `나이`) %>%
  filter(age >= 18) %>%
  mutate(
    bmi = weight / (height / 100)^2,
    age_group = case_when(
      age < 40 ~ "Young",
      age >= 40 & age < 60 ~ "Middle-aged", 
      age >= 60 ~ "Senior"
    )
  )
```

### 2. label Template

The label template focuses on making data human-readable:

**Codebook-based Approach:**
- Excel codebook with value_labels and variable_labels sheets
- Automated factor conversion
- Consistent label across datasets

**Manual label:**
- Direct factor() function usage
- case_when() for complex conditions
- Custom label assignment

### 3. Analysis Template

Statistical analysis using gtsummary package:

**Table 1 Generation:**
```r
# Descriptive statistics
table1 <- labeled_df %>%
  select(age, sex, bmi, outcome) %>%
  tbl_summary(
    by = outcome,
    statistic = list(
      all_continuous() ~ "{mean} ({sd})",
      all_categorical() ~ "{n} ({p}%)"
    )
  ) %>%
  add_p()
```

**Regression Analysis:**
```r
# Logistic regression
model <- glm(outcome ~ age + sex + bmi, 
             data = labeled_df, 
             family = "binomial")
             
tbl_regression(model, exponentiate = TRUE)
```

### 4. Shiny Template

Interactive dashboard with:
- Sidebar filtering controls
- Reactive data processing
- Multiple output tabs (plots, tables)
- User-friendly interface

### 5. Korean Medical Statistics Templates

#### jstable Template
- `mk.lev()` for consistent label
- `CreateTableOneJS()` for Table 1
- `glm.display()` and `Labeljs()` for regression tables

#### jskm Template  
- Kaplan-Meier survival curves
- Publication-ready plots
- Risk tables and p-values
- Multiple group comparisons

#### jsmodule Template
- Modular Shiny architecture
- Pre-built UI/Server modules
- Data and label management
- Scalable application design

## Customization

### Modifying Templates

While templates are hardcoded, you can:

1. **Extract and modify content:**
```{r customize, eval=FALSE}
# Get template content
my_template <- get_templates()$preprocess

# Modify as needed
modified_template <- gsub(
  "<path/to/your/data>",
  "data/my_dataset.csv",
  my_template
)

# Save to file for manual use
writeLines(modified_template, "my_custom_preprocess.md")
```

2. **Create project-specific variations:**
```{r project-specific, eval=FALSE}
# Create specialized commands for your project
create_project_commands <- function(project_name) {
  templates <- get_templates()

  # Customize for project
  for (name in names(templates)) {
    content <- gsub(
      "<path/to/your/data>",
      paste0("data/", project_name, "/"),
      templates[[name]]
    )

    # Write customized version
    writeLines(content, paste0(name, "_", project_name, ".md"))
  }
}
```

## Integration Patterns

### Sequential Workflow

Recommended order for data analysis projects:

1. **Setup**: `setup_gemini_commands()` or `setup_claude_commands()`
2. **preprocess**: Clean and prepare raw data
3. **label**: Apply meaningful labels and factors
4. **Analysis**: Generate statistical summaries and models
5. **Visualization**: Create interactive dashboards
6. **Publication**: Generate final tables and figures

### Tool-Specific Workflows

#### Gemini CLI Workflow
```bash
# Sequential execution
gemini preprocess
gemini label  
gemini analysis
gemini shiny
```

#### Claude Code Workflow
```
/preprocess [dataset_name]
/label [codebook_path]
/analysis [outcome_variable]
/shiny [dashboard_title]
```

## Performance Tips

1. **Template Selection**: Choose appropriate templates for your use case
2. **Data Size**: Consider memory limitations for large datasets
3. **Caching**: Save intermediate results as RDS files
4. **Parallel Processing**: Use parallel operations for large-scale analysis

## Troubleshooting

### Common Issues

1. **Package Dependencies**: Ensure required packages are installed
2. **File Paths**: Use absolute paths or proper working directory setup
3. **Encoding**: Maintain UTF-8 encoding for Korean text
4. **Memory**: Monitor memory usage with large datasets

### Debug Tips

```{r debug, eval=FALSE}
# Check template content
templates <- get_templates()
str(templates)

# Verify directory creation
list.files(".gemini/commands", full.names = TRUE)
list.files(".claude/commands", full.names = TRUE)

# Test individual functions
setup_gemini_commands()
setup_claude_commands()
```